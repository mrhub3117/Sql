CREATE TABLE Users (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    Name VARBINARY(MAX),
    Email VARBINARY(MAX)
);
CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'YourStrongPassword';
CREATE CERTIFICATE MyCertificate WITH SUBJECT = 'My Encryption Certificate';


CREATE SYMMETRIC KEY MySymmetricKey
WITH ALGORITHM = AES_256
ENCRYPTION BY CERTIFICATE MyCertificate;

OPEN SYMMETRIC KEY MySymmetricKey DECRYPTION BY CERTIFICATE MyCertificate;
INSERT INTO Users (Name, Email)
VALUES (
    ENCRYPTBYKEY(KEY_GUID('MySymmetricKey'), 'John Doe'),
    ENCRYPTBYKEY(KEY_GUID('MySymmetricKey'), 'john.doe@example.com')
);
CLOSE SYMMETRIC KEY MySymmetricKey;

OPEN SYMMETRIC KEY MySymmetricKey DECRYPTION BY CERTIFICATE MyCertificate;
SELECT 
    ID,
    CONVERT(VARCHAR, DECRYPTBYKEY(Name)) AS Name,
    CONVERT(VARCHAR, DECRYPTBYKEY(Email)) AS Email
FROM Users;
CLOSE SYMMETRIC KEY MySymmetricKey;
